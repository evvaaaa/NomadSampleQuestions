<!-- Parsed by flask with a questions yaml to give us the web form. -->
<!-- Shamelessly written with the help of AI promting (you can tell because it's crap) but it's just a proof of concept to show off next week. -->
<!DOCTYPE html>
<html>
<head>
  <title>Survey Form (Proof of Concept)</title>
  <script>
    function clearForm() {
      fetch('/clear_redis', {method: 'POST'})
        .then(response => response.json())
        .then(data => {
          document.querySelector('form').reset();
          alert(data.message);
        });
    }
  </script>
  <script>
    function addField(fieldId, fieldType, required, options) {
      const container = document.getElementById(fieldId + '_container');
      const count = container.querySelectorAll('.multi-input').length;
      let inputGroup = document.createElement('div');
      inputGroup.className = "multi-input";
      inputGroup.style.display = "flex";
      inputGroup.style.gap = "5px";
      let input;
      if (fieldType === "select") {
        input = document.createElement('select');
        input.name = fieldId;
        input.id = fieldId + "_" + count;
        if (required === "True") input.required = true;
        let opts = JSON.parse(options);
        for (let i = 0; i < opts.length; i++) {
          let option = document.createElement('option');
          option.value = opts[i];
          option.text = opts[i];
          input.add(option);
        }
      } else {
        input = document.createElement('input');
        input.type = fieldType === "text" ? "text" : fieldType;
        input.name = fieldId;
        input.id = fieldId + "_" + count;
        if (required === "True") input.required = true;
      }
      let removeBtn = document.createElement('button');
      removeBtn.type = "button";
      removeBtn.textContent = "âˆ’";
      removeBtn.onclick = function() {
        container.removeChild(inputGroup);
      };
      inputGroup.appendChild(input);
      inputGroup.appendChild(removeBtn);
      container.appendChild(inputGroup);
    }
  </script>
</head>
<body>
  <h2>Survey Form (Proof of Concept)</h2>
  <h3>This data will be used in your stored data. Be descriptive!</h3>
  <button type="button" onclick="clearForm()">Clear previous data from run engine.</button>
  <style>
    body, form, input, select, textarea, label, button {
      font-size: 1.2em;
    }
    input[type="text"], select, textarea {
      resize: vertical;
      min-height: 2em;
      min-width: 300px;
      margin-bottom: 5px;
      font-size: 1.2em;
    }
    .multi-input input, .multi-input select, .multi-input textarea { margin-right:2px; }
    .multi-input button { font-weight:bold; }
  </style>
  {% if error_msg %}
    <div style="color:red">{{ error_msg }}</div>
  {% endif %}
  <form method="post" autocomplete="off">
    {% for q in questions %}
      <label for="{{ q.id }}">{{ q.label }}</label><br>
      <div id="{{ q.id }}_container">
        {% if q.multiple %}
          {% if q.type == "select" %}
            <select id="{{ q.id }}_0" name="{{ q.id }}" {% if q.required %}required{% endif %}>
              {% for option in q.options %}
                <option value="{{ option }}">{{ option }}</option>
              {% endfor %}
            </select>
          {% else %}
            <input type="{{ 'text' if q.type == 'text' else q.type }}"
                   id="{{ q.id }}_0"
                   name="{{ q.id }}"
                   {% if q.required %}required{% endif %}>
          {% endif %}
          <br>
        {% else %}
          {% if q.type == "select" %}
            <select id="{{ q.id }}" name="{{ q.id }}" {% if q.required %}required{% endif %}>
              {% for option in q.options %}
                <option value="{{ option }}">{{ option }}</option>
              {% endfor %}
            </select>
          {% else %}
            <input type="{{ 'text' if q.type == 'text' else q.type }}"
                   id="{{ q.id }}"
                   name="{{ q.id }}"
                   {% if q.required %}required{% endif %}>
          {% endif %}
          <br>
        {% endif %}
      </div>
      {% if q.multiple %}
        <button type="button"
                onclick="addField('{{ q.id }}', '{{ q.type }}', '{{ q.required }}', '{{ q.options|tojson if q.type == 'select' else '' }}')">+</button>
      {% endif %}
      <br><br>
    {% endfor %}
    <input type="submit" value="Submit">
  </form>
  {% if saved and answers_yaml %}
    <h3>Answers saved to directory: {{ answers_directory }}</h3>
    <pre>{{ answers_yaml }}</pre>
  {% endif %}
</body>
</html>
